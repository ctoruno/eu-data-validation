---
title: "`r params$country` Country Report"
author: "Dalia Habiby"
date: "2023-10-27"
output: html_document
params:
  country: "CZ"
---


```{r setup, echo = F}

suppressMessages(library(tidyverse))
suppressMessages(library(haven))
suppressMessages(library(caret))
knitr::opts_chunk$set(echo = F)

source("TPS.R")

gpp<- suppressMessages(read_dta("../Input/example_clean.dta"))
tps<- suppressMessages(read_csv("../../TPS/TPS_data.csv"))
```


```{r}
df<- TPS_function(gpp, tps, params$country)

knitr::kable(df)
```

```{r}
flags<- df%>%
  group_by(Pillar)%>%
  count(Flag)

for (p in unique(df$Pillar)){
  
  pillar<- flags%>%
    filter(Pillar == p)
  
  sp<- sum(pillar$n)
  
  
  if ("red" %in% unique(pillar$Flag)){
  
    if (pillar$n[pillar$Flag == "red"]/sp >0.25){
    
    print(paste0("Pillar ", p, " is problematic"))
    
  }
  else {
    print(paste0("Pillar ", p, " is not problematic"))
  }
    
  }
  
}
```

